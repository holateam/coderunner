CodeRunner service 
------------------

### Node.js server

Постоянно работающий сервер, написанный на языке Javascript, запускается интерпритатором Node. Организован как системный сервис (можно использовать пакет forever-service).
Модуль отвечает за прием и обработку REST запросов на тестирование пользовательского кода, и на анализ уже готовых результатов.

Сервер должен взаимодействие с внешним сервером логирования и рассылки.

Сервер принимает следующие запросы:
***
**Запрос на проведение тестирования**
```
	Метод : POST
	Путь : /isolatedTest
	Тело : 
	{
		code: “”,
		language: “”,
		testCases: [ “stdIn 1”, “stdIn 2” ]
	}
```
**Формат ответа на запрос**
```
	Код ответа : 200 (запрос принят) / 400 (запрос отклоняется из за переполнения очереди)
	Тело : 
	{
		compiler errors: "",
		stdout : [ “testcase1 otp”, “testcase2 otp” ],
		stderr : [ “testcase1 err”, “testcase2 err” ],
		timestamps : [ “testcase1 duration”, “testcase2 duration” ]
	}
```
***
**Запрос на обработку результатов тестирования**
*Будет сформирован и отправлен ответ на запрос тестирования*
```
	Метод : GET
	Путь : /analyseTest/:<sessionID>
```
**Формат ответа на запрос**
```
	Код ответа : 200
	Тело : { data : null }
```
***
**Запрос на наличие свободных мест в очереди Docker-контейнеров**
```
	Метод : GET
	Путь : /freeSlots
```
**Формат ответа на запрос**
```
	Код ответа : 200 (если мест больше чем 0) / 400 (если свободных мест нет)
	Тело : { data : n } (n -- количество свободных слотов)
```
***

Сервер должен ограничивать количество запросов на компиляцию для каждого пользователя.
Запросы принимаются исключительно от доверенных серверов. Остальные -- игнорируются.

После приема и подтверждения запроса выполняются следующие действия:
- Генерирование случайного идентификатора ```sessionId``` для сессии тестирования.
- Санитаризация входящего кода.
- Подготовка общей директории для виртуальной машины и хоста ```~/.coderunner/sessionId```.
- Помещение конфигураций докера в файл ```~/.coderunner/sessionId/config```
- Создание в директории ```~/.coderunner/sessionId/input``` файлов ```source.x``` с исходным кодом, где x - соотествующее языку програмирования расширение и ```testcases```, который стостоит из строк входных данных для последоватлеьного тестирования.
- Добавление контейнера в очередь на выполнение.


### Модуль санитаризации кода

Клас со статическим методом, который принимает параметром строку с кодом и маркер языка.
Результат работы метода -- список обнаруженных нарушений в коде в виде массива:
```
[
	{
		line: 0, 			(номер линии с нарушением)
		danger-level: 0, 	(уровень опасности, чем выше -- тем хуже)
		text: "",			(строка с нарушением)
		comment: ""			(описание обнаруженного нарушения)
	}, ... {}
]
```

### Сервер логирования и рассылки

Сервер отвечает за логирование (записть в базу) приходящие на него месседжы, и отправлять на зарезервированные адреса письма, при необходимости. Необходимость определяется специальным флагом запроса к серверу.
При возникновении внутренних о

Сервер принимает запросы:

***
**Запрос на логирование**
```
	Метод : POST
	Путь : /log
	Тело : {
		user : "",
		type : info / warning / error / breach,
		broadcast : true / false
	}
```
**Формат ответа на запрос**
```
	Код ответа : 200 (если сервер принял и обработал запрос) / 400 (если возникли ошибки и сообщение не сохранено в базу)
```
***

### Менеджер очереди Docker контейнеров

Конструктор модуля принимает параметром число -- пропускная способность (количество паралельно запущенных контейнеров).
В очередь можно добавить контейнер для выполнения. ```enqueue(sessionId)``` Запуск контейнера происходит вызовом ```docker-handler.sh```.
Удалять контейнеры из очереди (когда сессия тестирования завершена) нужно при помощи метода ```free(sessionId)```.

### docker-handler.sh

Комманда получает единственным аргумментом sessionId, это позволяет найти соответствующую сессии директорию, прочитать файл конфигураций и запустить Docker контейнер с нужными параметрами.
Скрипт должен ожидать уничтожения контейнера (```bash wait```), после чего подавать запрос на REST API на обработку результатов выполнения (```curl localhost/analyseTest/:sessionId```).

### install.sh

Скрипт развертки приложения CodeRunner.
Скрипт должен удостоверить наличие на сервере необходимых пакетов (```which```), и в случае их отсутствия: установить.
Необходимые пакеты: node, npm, forever, forever-service, остальные модули, curl, docker, файлы node сервера, образы Docker контейнеров.

### Внутренние Bash скрипты для Docker

```сompiler.sh```
input: файл с кодом пользователя (с валидным расширением)
output: комманда для выполнения

```tester.sh```
input: файл с тесткейсами, комманда для выполнения
output: файлы с результатами тестирования